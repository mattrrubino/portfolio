(()=>{"use strict";var t={426:(t,e,r)=>{r.d(e,{Z:()=>o});var a=r(645),n=r.n(a)()((function(t){return t[1]}));n.push([t.id,"body {\r\n    height: 100vh;\r\n    width: 100vw;\r\n    padding: 0;\r\n    margin: 0;\r\n\r\n    overflow: hidden;\r\n}\r\n\r\n.cases-line {\r\n    grid-column: 1;\r\n    grid-row: 1;\r\n}\r\n\r\n.cases-geo {\r\n    grid-column: 2;\r\n    grid-row: 1;\r\n}\r\n\r\n.deaths-line {\r\n    grid-column: 1;\r\n    grid-row: 2;\r\n}\r\n\r\n.deaths-geo {\r\n    grid-column: 2;\r\n    grid-row: 2;\r\n}\r\n\r\n.line-path {\r\n    fill: none;\r\n    stroke-width: 3px;\r\n    stroke-linecap: round;\r\n}\r\n\r\n.title {\r\n    font-family: sans-serif;\r\n    text-anchor: middle;\r\n    font-size: 16pt;\r\n}\r\n\r\n.axis-label {\r\n    text-anchor: middle;\r\n    font-size: 12pt;\r\n    color: black;\r\n    fill: black;\r\n}\r\n\r\n.selection-rect {\r\n    fill: none;\r\n    pointer-events: all;\r\n}\r\n\r\n.hover-text {\r\n    pointer-events: none;\r\n    font-size: 8pt;\r\n    text-shadow:\r\n        -1px -1px 3px white,\r\n        -1px 1px 3px white,\r\n        1px -1px 3px white,\r\n        -1px -1px 3px white;\r\n}\r\n\r\n.noselect {\r\n    -webkit-touch-callout: none;\r\n    -webkit-user-select: none;\r\n    -khtml-user-select: none;\r\n    -moz-user-select: none;\r\n    -ms-user-select: none;\r\n    user-select: none;\r\n}\r\n\r\n.axis-label {\r\n    fill: #ababab;\r\n}\r\n\r\n.y-axis {\r\n    color: #ababab;\r\n}\r\n\r\n.x-axis {\r\n    color: #ababab;\r\n}\r\n\r\n.legend-box {\r\n    font-size: 16pt;\r\n}\r\n\r\n.loading {\r\n    height: 100vh;\r\n    width: 100vw;\r\n\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n}\r\n\r\n.loading-spinner {\r\n    height: 50vw;\r\n    width: 50vw;\r\n\r\n    border: 5vw solid lightgrey;\r\n    border-top: 5vw solid red;\r\n    border-radius: 50%;\r\n\r\n    animation: rotate 3s linear infinite;\r\n}\r\n\r\n@media screen and (min-aspect-ratio: 1/1) {\r\n    .loading-spinner {\r\n        height: 50vh;\r\n        width: 50vh;\r\n\r\n        border-width: 5vh;\r\n    }\r\n}\r\n\r\n@keyframes rotate {\r\n    from {\r\n        transform: rotate(0deg);\r\n    }\r\n    to {\r\n        transform: rotate(360deg);\r\n    }\r\n}\r\n",""]);const o=n},645:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var r=t(e);return e[2]?"@media ".concat(e[2]," {").concat(r,"}"):r})).join("")},e.i=function(t,r,a){"string"==typeof t&&(t=[[null,t,""]]);var n={};if(a)for(var o=0;o<this.length;o++){var s=this[o][0];null!=s&&(n[s]=!0)}for(var l=0;l<t.length;l++){var i=[].concat(t[l]);a&&n[i[0]]||(r&&(i[2]?i[2]="".concat(r," and ").concat(i[2]):i[2]=r),e.push(i))}},e}},695:t=>{var e={};t.exports=function(t){if(void 0===e[t]){var r=document.querySelector(t);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(t){r=null}e[t]=r}return e[t]}},379:t=>{var e=[];function r(t){for(var r=-1,a=0;a<e.length;a++)if(e[a].identifier===t){r=a;break}return r}function a(t,a){for(var o={},s=[],l=0;l<t.length;l++){var i=t[l],c=a.base?i[0]+a.base:i[0],d=o[c]||0,p="".concat(c," ").concat(d);o[c]=d+1;var h=r(p),m={css:i[1],media:i[2],sourceMap:i[3]};-1!==h?(e[h].references++,e[h].updater(m)):e.push({identifier:p,updater:n(m,a),references:1}),s.push(p)}return s}function n(t,e){var r=e.domAPI(e);return r.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;r.update(t=e)}else r.remove()}}t.exports=function(t,n){var o=a(t=t||[],n=n||{});return function(t){t=t||[];for(var s=0;s<o.length;s++){var l=r(o[s]);e[l].references--}for(var i=a(t,n),c=0;c<o.length;c++){var d=r(o[c]);0===e[d].references&&(e[d].updater(),e.splice(d,1))}o=i}}},216:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e),e}},795:t=>{t.exports=function(t){var e=t.insertStyleElement(t);return{update:function(r){!function(t,e,r){var a=r.css,n=r.media,o=r.sourceMap;n?t.setAttribute("media",n):t.removeAttribute("media"),o&&"undefined"!=typeof btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),e.styleTagTransform(a,t)}(e,t,r)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}}},e={};function r(a){var n=e[a];if(void 0!==n)return n.exports;var o=e[a]={id:a,exports:{}};return t[a](o,o.exports,r),o.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var a in e)r.o(e,a)&&!r.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{const t=(t,e)=>{const{margin:r,xValue:a,xAxisLabel:n,xScale:o,xTicks:s,formatX:l,formatXHover:i,yValue:c,yAxisLabel:d,yScale:p,yTicks:h,formatY:m,formatYHover:g,title:f,setSelectedData:u,selectedData:x,selecting:v,setSelecting:b,lineColor:w,data:y}=e,S=+t.attr("height"),A=+t.attr("width")-r.right-r.left,D=S-r.top-r.bottom,k=t.selectAll(".line-chart").data([null]),T=k.enter().append("g").attr("class","line-chart");T.merge(k).attr("transform",`translate(${r.left}, ${r.top})`);const E=d3.axisBottom(o.range([0,A])).ticks(s).tickSize(-D).tickFormat(l),L=k.selectAll(".x-axis"),$=T.append("g").attr("class","x-axis noselect").attr("transform",`translate(0, ${D})`);$.merge(L).call(E).selectAll(".domain").remove(),$.append("text").attr("class","axis-label").attr("transform",`translate(${A/2}, 30)`).text(n);const F=d3.axisLeft(p.range([D,0])).ticks(h).tickSize(-A).tickFormat(m),C=k.selectAll(".y-axis"),M=T.append("g").attr("class","y-axis noselect");M.merge(C).call(F).selectAll(".domain").remove(),M.append("text").attr("class","axis-label noselect").attr("transform",`rotate(-90) translate(${-D/2}, -30)`).text(d);const V=d3.line().x((t=>o(a(t)))).y((t=>p(c(t)))).curve(d3.curveBasis);k.selectAll(".line-path"),T.append("path").attr("class","line-path").attr("stroke",w).attr("d",V(y)),T.append("text").merge(k.selectAll(".title")).attr("class","title noselect").attr("x",A/2).attr("y",-10).text(f);const z=d3.bisector(a).left,N=t=>{const e=d3.pointer(t)[0],r=o.invert(e),a=z(y,r,1);null!=y[a]&&u(y[a])};T.append("rect").attr("width",A).attr("height",D).attr("class","selection-rect").merge(k.selectAll(".selection-rect")).on("click",(t=>{b(!v),N(t)})).on("mousemove",(t=>{v&&N(t)}));const H=k.selectAll(".hover"),I=T.append("g").attr("class","hover");I.merge(H).attr("transform",(()=>`translate(${o(a(x??y[0]))??0}, ${p(c(x??y[0]))??0})`)),I.append("circle").attr("pointer-events","none").merge(H.selectAll("circle")).attr("fill",v?w:"black").attr("opacity",v?.5:1).attr("r",x?5:0);const j=H.selectAll(".hover-text"),G=I.append("text").attr("class","hover-text noselect").attr("transform","translate(10, 0)");G.merge(j).attr("fill",x?"black":"none"),G.append("tspan").attr("class","x-hover-text").attr("x",0).merge(j.selectAll(".x-hover-text")).text(n+": "+i(a(x??y[0]))),G.append("tspan").attr("class","y-hover-text").attr("x",0).attr("dy",12).merge(j.selectAll(".y-hover-text")).text(d+": "+g(c(x??y[0])))},e=(t,e)=>{const{height:r,width:a,colorScale:n,colorLabel:o,colorFormat:s}=e,l=t.selectAll(".color-legend").data([null]).enter().append("g").attr("class","color-legend noselect");l.append("text").attr("class","title").text(o);const i=l.append("linearGradient").attr("id",o+" Gradient").attr("gradientTransform","rotate(90)");i.append("stop").attr("offset","0%").attr("stop-color",n.range()[1]),i.append("stop").attr("offset","100%").attr("stop-color",n.range()[0]);const c=l.append("g").attr("class","legend-box").attr("transform","translate(-25, 20)"),d=(c.append("rect").attr("class","legend-rect").attr("height",r).attr("width",a).attr("fill",`url("#${o+" Gradient"}")`),d3.scaleSqrt().domain(n.domain()).range([r,0]).nice()),p=d3.axisLeft(d).tickSize(-a).tickFormat(s);c.call(p).selectAll(".domain").remove()},a=new Map,n=(t,r)=>{const{margin:n,xValue:o,xFormat:s,colorValue:l,colorScale:i,colorLabel:c,colorFormat:d,geoGenerator:p,geoName:h,geoRegion:m,geoData:g,selectedData:f,groupedData:u}=r,x=+t.attr("height"),v=+t.attr("width"),b=x-n.top-n.bottom,w=v-n.left-n.right,y=t.selectAll(".geo-graph").data([null]),S=y.enter().append("g").attr("class","geo-graph"),A=d3.bisector(o).left;u.forEach(((t,e)=>{const r=A(t,o(f??t[0]),1);a.set(e,t[r]??t[t.length-1])}));const D=S.merge(y).selectAll(".region").data(g.features),k=D.enter().append("path").attr("class","region").attr("title",h).attr("d",p);k.append("title"),k.merge(D).attr("fill",(t=>i(l(a.get(m(t)))))).select("title").text((t=>{const e=""+l(a.get(m(t)));return s(o(f))+"\n"+h(t)+"\n"+c+": "+d(e)}));const T=t.select(".geo-graph").node().getBBox(),E=b/T.height,L=w/T.width,$=Math.min(E,L);S.attr("transform",`translate(${n.left}, ${n.top}) scale(${$})`),S.append("g").call(e,{height:450,width:60,colorScale:i,colorLabel:c,colorFormat:d}).attr("transform",`translate(${2*v}, 0)`)};var o=r(379),s=r.n(o),l=r(795),i=r.n(l),c=r(695),d=r.n(c),p=r(216),h=r.n(p),m=r(426),g={styleTagTransform:function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}},setAttributes:function(t){var e=r.nc;e&&t.setAttribute("nonce",e)},insert:function(t){var e=d()("head");if(!e)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");e.appendChild(t)}};let f,u,x,v,b,w;g.domAPI=i(),g.insertStyleElement=h(),s()(m.Z,g),m.Z&&m.Z.locals&&m.Z.locals;const y=d3.select(".loading");Promise.all([d3.csv("https://raw.githubusercontent.com/nytimes/covid-19-data/master/us.csv"),d3.csv("https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-states.csv"),d3.json("https://raw.githubusercontent.com/mattrrubino/covid-visualization/main/us_geo.json")]).then((([t,e,r])=>{t.forEach((t=>{t.date=new Date(t.date),t.cases=+t.cases,t.deaths=+t.deaths})),e.forEach((t=>{t.date=new Date(t.date),t.fips=+t.fips,t.cases=+t.cases,t.deaths=+t.deaths})),r.features.forEach((t=>{t.properties.STATE=+t.properties.STATE}));const a=d3.group(e,(t=>t.fips));a.forEach(((t,e)=>{let r=0,n=0;t.forEach((t=>{t.cases=t.cases-r,t.deaths=t.deaths-n,r+=t.cases,n+=t.deaths})),a.set(e,t.filter((t=>0!==t.cases||0!==t.deaths)))}));const n=new Map;return a.forEach(((t,e)=>{const r=[];t.forEach(((e,a)=>{const n=t.slice(Math.max(a+1-20,0),a+1),o=n.reduce(((t,e)=>t+e.cases),0)/n.length,s=n.reduce(((t,e)=>t+e.deaths),0)/n.length;r.push({date:e.date,state:e.state,fips:e.fips,cases:o,deaths:s})})),n.set(e,r)})),{usData:t,usStatesData:n,usGeo:r}})).then((t=>{f=t.usData,u=t.usStatesData,x=Array.from(u,(([t,e])=>e)).flat(),v=t.usGeo,b=f[0],w=!0,y.remove(),Y()}));const S=d3.select(".graphs"),A=+d3.select(".graphs").attr("height"),D=+d3.select(".graphs").attr("width"),k=S.append("g").attr("class","cases-line").attr("height",A/2).attr("width",D/2),T=S.append("g").attr("class","cases-geo").attr("height",A/2).attr("width",D/2).attr("transform",`translate(${D/2}, 0)`),E=S.append("g").attr("class","deaths-line").attr("height",A/2).attr("width",D/2).attr("transform",`translate(0, ${A/2})`),L=S.append("g").attr("class","deaths-geo").attr("height",A/2).attr("width",D/2).attr("transform",`translate(${D/2}, ${A/2})`),$=()=>{const t=window.innerHeight,e=window.innerWidth,r=Math.min(e/D,t/A),a=(e-D*r)/2,n=(t-A*r)/2;S.attr("transform",`translate(${a}, ${n}) scale(${r})`)};window.addEventListener("resize",$),$();const F=t=>t.date,C=t=>t.cases,M=t=>t.deaths,V=t=>{b=t,Y()},z=t=>{w=t,Y()},N=new Intl.DateTimeFormat("en-US",{month:"short"}),H=new Intl.DateTimeFormat("en-US",{month:"short",day:"2-digit"}),I=t=>t.properties.NAME,j=t=>t.properties.STATE,G=d3.geoAlbersUsa(),O=d3.geoPath().projection(G),Y=()=>{const e=d3.scaleTime().domain(d3.extent(f,F)),r=d3.scaleLinear().domain([0,d3.max(f,C)]).nice(),a=d3.scaleLinear().domain([0,d3.max(f,M)]).nice(),o=d3.scaleSequentialSqrt().domain([0,d3.max(x,C)]).interpolator(d3.interpolateReds),s=d3.scaleSequentialSqrt().domain([0,d3.max(x,M)]).interpolator(d3.interpolateBlues);k.call(t,{margin:{top:40,right:10,bottom:40,left:50},xValue:F,xAxisLabel:"Date",xScale:e,xTicks:14,formatX:t=>N.format(t).substring(0,1)+t.getFullYear().toString().substring(2),formatXHover:H.format,yValue:C,yAxisLabel:"Cases",yScale:r,yTicks:8,formatY:t=>d3.format(".2s")(t).replace(".0",""),formatYHover:d3.format(".3s"),title:"US COVID Cases Over Time",setSelectedData:V,selectedData:b,setSelecting:z,selecting:w,lineColor:"red",data:f}),T.call(n,{margin:{top:20,right:100,bottom:0,left:0},xValue:F,xFormat:H.format,colorValue:C,colorScale:o,colorLabel:"New Cases",colorFormat:t=>d3.format(".2s")(Math.round(+t)),geoGenerator:O,geoName:I,geoRegion:j,geoData:v,selectedData:b,groupedData:u}),E.call(t,{margin:{top:40,right:10,bottom:40,left:50},xValue:F,xAxisLabel:"Date",xScale:e,xTicks:14,formatX:t=>N.format(t).substring(0,1)+t.getFullYear().toString().substring(2),formatXHover:H.format,yValue:M,yAxisLabel:"Deaths",yScale:a,yTicks:8,formatY:t=>d3.format(".2s")(t).replace(".0",""),formatYHover:d3.format(".3s"),title:"US COVID Deaths Over Time",setSelectedData:V,selectedData:b,setSelecting:z,selecting:w,lineColor:"blue",data:f}),L.call(n,{margin:{top:20,right:100,bottom:0,left:0},xValue:F,xFormat:H.format,colorValue:M,colorScale:s,colorLabel:"New Deaths",colorFormat:t=>d3.format(".2s")(Math.round(+t)),geoGenerator:O,geoName:I,geoRegion:j,geoData:v,selectedData:b,groupedData:u})}})()})();
